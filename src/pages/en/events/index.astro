---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const events = await getCollection('events');
const now = new Date();

// Split into upcoming and past
const upcomingEvents = events
  .filter(e => e.data.event_date >= now)
  .sort((a, b) => a.data.event_date.getTime() - b.data.event_date.getTime());

const pastEvents = events
  .filter(e => e.data.event_date < now)
  .sort((a, b) => b.data.event_date.getTime() - a.data.event_date.getTime());
---

<BaseLayout title="Events" description="Join us for tastings, tours, workshops, and festivals at Clarity Brewing taprooms.">
  <h1>Events</h1>
  <p class="page-intro">
    Join us at our taprooms for tastings, tours, workshops, and more.
    Whether you're a NA beer curious newcomer or a seasoned enthusiast,
    there's something for everyone.
  </p>

  {upcomingEvents.length > 0 && (
    <section class="events-section">
      <h2>Upcoming Events</h2>
      <div class="events-grid">
        {upcomingEvents.map(event => (
          <article class="event-card">
            <div class="event-date-badge">
              <span class="event-month">
                {event.data.event_date.toLocaleDateString('en-US', { month: 'short' })}
              </span>
              <span class="event-day">
                {event.data.event_date.getDate()}
              </span>
            </div>
            <div class="event-details">
              <div class="event-header">
                <span class="event-type">{event.data.event_type}</span>
                <span class="event-price">
                  {event.data.price === 0 ? 'Free' : `$${event.data.price}`}
                </span>
              </div>
              <h3><a href={`/en/events/${event.slug}/`}>{event.data.title}</a></h3>
              <p class="event-meta">
                üìç {event.data.location_name}
                {event.data.capacity && (
                  <span> ¬∑ {event.data.capacity} spots</span>
                )}
              </p>
              <p>{event.data.description}</p>
            </div>
          </article>
        ))}
      </div>
    </section>
  )}

  {upcomingEvents.length === 0 && (
    <section class="events-section">
      <div class="no-events">
        <h2>No Upcoming Events</h2>
        <p>Check back soon for new events, or sign up for our newsletter to be notified.</p>
      </div>
    </section>
  )}

  {pastEvents.length > 0 && (
    <section class="events-section past-events">
      <h2>Past Events</h2>
      <div class="events-grid">
        {pastEvents.map(event => (
          <article class="event-card event-card-past">
            <div class="event-date-badge">
              <span class="event-month">
                {event.data.event_date.toLocaleDateString('en-US', { month: 'short' })}
              </span>
              <span class="event-day">
                {event.data.event_date.getDate()}
              </span>
            </div>
            <div class="event-details">
              <div class="event-header">
                <span class="event-type">{event.data.event_type}</span>
              </div>
              <h3><a href={`/en/events/${event.slug}/`}>{event.data.title}</a></h3>
              <p class="event-meta">üìç {event.data.location_name}</p>
            </div>
          </article>
        ))}
      </div>
    </section>
  )}
</BaseLayout>

<style>
  .page-intro {
    font-size: 1.125rem;
    color: var(--color-text-light);
    max-width: 700px;
    margin-bottom: 2rem;
  }

  .events-section {
    margin-bottom: 3rem;
  }

  .events-section h2 {
    margin-bottom: 1.5rem;
  }

  .events-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .event-card {
    display: flex;
    gap: 1.5rem;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1.5rem;
  }

  .event-card-past {
    opacity: 0.7;
  }

  .event-date-badge {
    flex-shrink: 0;
    width: 70px;
    text-align: center;
    background: var(--color-primary);
    color: white;
    border-radius: 8px;
    padding: 0.75rem;
  }

  .event-month {
    display: block;
    font-size: 0.875rem;
    text-transform: uppercase;
  }

  .event-day {
    display: block;
    font-size: 1.75rem;
    font-weight: bold;
    line-height: 1;
  }

  .event-details {
    flex: 1;
  }

  .event-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .event-type {
    background: var(--color-secondary);
    color: var(--color-primary);
    padding: 0.25rem 0.75rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .event-price {
    font-weight: 600;
    color: var(--color-primary);
  }

  .event-details h3 {
    margin-bottom: 0.5rem;
  }

  .event-details h3 a {
    color: var(--color-text);
  }

  .event-details h3 a:hover {
    color: var(--color-primary);
  }

  .event-meta {
    font-size: 0.875rem;
    color: var(--color-text-light);
    margin-bottom: 0.5rem;
  }

  .no-events {
    text-align: center;
    padding: 3rem;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: 8px;
  }

  .no-events h2 {
    color: var(--color-text-light);
  }

  .past-events h2 {
    color: var(--color-text-light);
  }

  @media (max-width: 600px) {
    .event-card {
      flex-direction: column;
    }

    .event-date-badge {
      width: 100%;
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
    }

    .event-month, .event-day {
      display: inline;
      font-size: 1rem;
    }
  }
</style>
