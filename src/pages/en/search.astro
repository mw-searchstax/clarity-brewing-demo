---
import BaseLayout from '../../layouts/BaseLayout.astro';

const searchURL = import.meta.env.PUBLIC_SEARCHSTAX_SEARCH_URL;
const suggestURL = import.meta.env.PUBLIC_SEARCHSTAX_SUGGEST_URL;
const token = import.meta.env.PUBLIC_SEARCHSTAX_TOKEN;
const trackKey = import.meta.env.PUBLIC_SEARCHSTAX_TRACK_KEY;
---

<BaseLayout title="Search" description="Search across all Clarity Brewing content - beers, articles, events, and locations.">
  <h1>Search</h1>
  <p class="page-intro">
    Search across all our content - beers, articles, events, and locations.
  </p>

  <div id="searchstax-input-container"></div>

  <div class="search-layout">
    <aside class="search-sidebar">
      <div id="searchstax-facets-container"></div>
    </aside>
    <main class="search-results">
      <div id="searchstax-sorting-container"></div>
      <div id="searchstax-results-container"></div>
      <div id="searchstax-pagination-container"></div>
    </main>
  </div>
</BaseLayout>

<style>
  .page-intro {
    font-size: 1.125rem;
    color: var(--color-text-light);
    margin-bottom: 2rem;
  }

  .search-layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 2rem;
    margin-top: 1.5rem;
  }

  .search-sidebar {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid var(--color-border);
    height: fit-content;
  }

  .search-results {
    min-height: 400px;
  }

  @media (max-width: 768px) {
    .search-layout {
      grid-template-columns: 1fr;
    }
  }
</style>

<link rel="stylesheet" href="/searchstax.css" />

<script>
  import { Searchstax } from '@searchstax-inc/searchstudio-ux-js';

  const searchURL = import.meta.env.PUBLIC_SEARCHSTAX_SEARCH_URL;
  const suggestURL = import.meta.env.PUBLIC_SEARCHSTAX_SUGGEST_URL;
  const token = import.meta.env.PUBLIC_SEARCHSTAX_TOKEN;
  const trackKey = import.meta.env.PUBLIC_SEARCHSTAX_TRACK_KEY;

  if (!searchURL) {
    console.error('SearchStax: Missing configuration. Set PUBLIC_SEARCHSTAX_* env variables.');
    const container = document.getElementById('searchstax-input-container');
    if (container) {
      container.innerHTML = '<p style="color: #666; padding: 1rem;">Search is being configured...</p>';
    }
  } else {
    const searchstax = new Searchstax();

    searchstax.initialize({
      searchURL: searchURL,
      suggesterURL: suggestURL,
      searchAuth: token,
      trackApiKey: trackKey,
      authType: 'token',
      language: 'en'
    });

    searchstax.addSearchInputWidget('searchstax-input-container', {
      placeholder: 'Search beers, articles, events...'
    });

    searchstax.addSearchResultsWidget('searchstax-results-container', {});

    searchstax.addFacetsWidget('searchstax-facets-container', {});

    searchstax.addPaginationWidget('searchstax-pagination-container', {});

    searchstax.addSearchSortingWidget('searchstax-sorting-container', {});
  }
</script>
