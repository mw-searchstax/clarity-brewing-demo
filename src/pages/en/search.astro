---
import BaseLayout from '../../layouts/BaseLayout.astro';

const searchURL = import.meta.env.PUBLIC_SEARCHSTAX_SEARCH_URL;
const suggestURL = import.meta.env.PUBLIC_SEARCHSTAX_SUGGEST_URL;
const token = import.meta.env.PUBLIC_SEARCHSTAX_TOKEN;
const trackKey = import.meta.env.PUBLIC_SEARCHSTAX_TRACK_KEY;
---

<BaseLayout title="Search" description="Search across all Clarity Brewing content - beers, articles, events, and locations.">
  <h1>Search</h1>
  <p class="page-intro">
    Search across all our content - beers, articles, events, and locations.
  </p>

  <div id="searchstax-input-container"></div>

  <div class="search-layout">
    <aside class="search-sidebar">
      <div id="searchstax-facets-container"></div>
    </aside>
    <main class="search-results">
      <div id="searchstax-sorting-container"></div>
      <div id="searchstax-results-container"></div>
      <div id="searchstax-pagination-container"></div>
    </main>
  </div>
</BaseLayout>

<style>
  .page-intro {
    font-size: 1.125rem;
    color: var(--color-text-light);
    margin-bottom: 2rem;
  }

  .search-layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 2rem;
    margin-top: 1.5rem;
  }

  .search-sidebar {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid var(--color-border);
    height: fit-content;
  }

  .search-results {
    min-height: 400px;
  }

  @media (max-width: 768px) {
    .search-layout {
      grid-template-columns: 1fr;
    }
  }
</style>

<link rel="stylesheet" href="https://static.searchstax.com/studio-js/v4/css/search-ux.css" />
<script is:inline src="https://static.searchstax.com/studio-js/v4/js/search-ux.js"></script>

<script is:inline define:vars={{ searchURL, suggestURL, token, trackKey }}>
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof SearchstaxSDK === 'undefined') {
      console.error('SearchStax SDK not loaded');
      return;
    }

    const searchstax = new SearchstaxSDK({
      searchURL: searchURL,
      suggesterURL: suggestURL,
      searchAuth: token,
      trackApiKey: trackKey,
      authType: 'token',
      language: 'en'
    });

    searchstax.initialize();

    searchstax.renderInputWidget({
      containerSelector: '#searchstax-input-container',
      placeholder: 'Search beers, articles, events...'
    });

    searchstax.renderResultsWidget({
      containerSelector: '#searchstax-results-container'
    });

    searchstax.renderFacetsWidget({
      containerSelector: '#searchstax-facets-container'
    });

    searchstax.renderPaginationWidget({
      containerSelector: '#searchstax-pagination-container'
    });

    searchstax.renderSortingWidget({
      containerSelector: '#searchstax-sorting-container'
    });
  });
</script>
